version: '3.8'

services:
  onboarding-test:
    build:
      context: ../..
      dockerfile: tests/integration/Dockerfile
    container_name: ao-onboarding-test
    command: /workspace/agent-orchestrator/tests/integration/onboarding-test.sh
    environment:
      - NODE_ENV=test
      - CI=true
    # Mount the repo for live development (optional)
    volumes:
      - ../..:/workspace/agent-orchestrator
    # Expose ports for debugging (optional)
    # Use 9000/9001/9003 on host to avoid conflicts with orchestrator
    # Container still uses 9000/14800/14801 internally
    ports:
      - "9000:9000"   # Dashboard (host:container)
      - "9001:14800"  # Terminal WebSocket (host:container)
      - "9003:14801"  # DirectTerminal WebSocket (host:container)
    # Increase shared memory for browser-based tests (future)
    shm_size: 2gb
